{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{useAuth}from'../context/AuthContext';import UserEditModal from'../components/UserEditModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AdminDashboard=()=>{const{userInfo,logout,authFetch}=useAuth();const[activeTab,setActiveTab]=useState('users');const[users,setUsers]=useState([]);const[logs,setLogs]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[editingUser,setEditingUser]=useState(null);const navigate=useNavigate();// 添加导航钩子\nuseEffect(()=>{console.log('AdminDashboard - 当前用户:',userInfo);// 立即检查用户权限\nif(!userInfo||!userInfo.isAdmin){console.log('AdminDashboard - 非管理员访问，重定向到用户仪表板');navigate('/user-dashboard');return;}fetchData(activeTab);},[activeTab,navigate,userInfo]);const fetchData=async tab=>{setLoading(true);setError(null);try{if(tab==='users'){await fetchUsers();}else if(tab==='logs'){await fetchLogs();}}catch(err){console.error('获取数据失败:',err);setError(err.message||'获取数据失败');// 检查是否是权限问题(403)\nif(err.message.includes('权限')||err.message.includes('访问被拒绝')){console.log('权限被拒绝，重定向到用户仪表板');navigate('/user-dashboard');}}finally{setLoading(false);}};const fetchUsers=async()=>{const response=await authFetch('/api/users');if(!response.ok){const data=await response.json();// 特别处理403错误\nif(response.status===403){console.log('管理员API访问被拒绝，重定向到用户仪表板');navigate('/user-dashboard');}throw new Error(data.message||'获取用户列表失败');}const data=await response.json();setUsers(data);};const fetchLogs=async()=>{const response=await authFetch('/api/logs');if(!response.ok){const data=await response.json();// 特别处理403错误\nif(response.status===403){console.log('管理员API访问被拒绝，重定向到用户仪表板');navigate('/user-dashboard');}throw new Error(data.message||'获取日志失败');}const data=await response.json();setLogs(data);};const formatDate=dateString=>{const date=new Date(dateString);return date.toLocaleString('zh-CN');};const handleSaveUser=async updatedData=>{try{const response=await authFetch(`/api/users/${editingUser._id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(updatedData)});// 防御性检查\nif(!response||!response.json){throw new Error('无效的服务器响应');}const data=await response.json();if(!response.ok){throw new Error(data.message||`请求失败 (${response.status})`);}await fetchUsers();setEditingUser(null);}catch(err){setError(err.message);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-100\",children:[/*#__PURE__*/_jsx(\"nav\",{className:\"bg-indigo-600 shadow-md\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between h-16\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold text-white\",children:\"\\u7BA1\\u7406\\u5458\\u63A7\\u5236\\u9762\\u677F\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-white mr-4\",children:[\"\\u7BA1\\u7406\\u5458\\uFF1A\",userInfo.username]})})]})})}),/*#__PURE__*/_jsx(\"main\",{className:\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-6 sm:px-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex border-b border-gray-200\",children:[/*#__PURE__*/_jsx(\"button\",{className:`py-2 px-4 font-medium text-sm ${activeTab==='users'?'border-b-2 border-indigo-500 text-indigo-600':'text-gray-500 hover:text-gray-700'}`,onClick:()=>setActiveTab('users'),children:\"\\u7528\\u6237\\u7BA1\\u7406\"}),/*#__PURE__*/_jsx(\"button\",{className:`py-2 px-4 font-medium text-sm ${activeTab==='logs'?'border-b-2 border-indigo-500 text-indigo-600':'text-gray-500 hover:text-gray-700'}`,onClick:()=>setActiveTab('logs'),children:\"\\u7CFB\\u7EDF\\u65E5\\u5FD7\"})]})}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"\\u52A0\\u8F7D\\u4E2D...\"})}):error?/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded\",children:/*#__PURE__*/_jsx(\"p\",{children:error})}):/*#__PURE__*/_jsxs(_Fragment,{children:[activeTab==='users'&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow overflow-hidden sm:rounded-lg\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u7528\\u6237\\u540D\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u90AE\\u7BB1\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u89D2\\u8272\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u72B6\\u6001\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u6CE8\\u518C\\u65F6\\u95F4\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u6700\\u540E\\u767B\\u5F55\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:[users.map(user=>/*#__PURE__*/_jsxs(\"tr\",{onClick:()=>setEditingUser(user),className:\"hover:bg-gray-50 cursor-pointer transition-colors\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\",children:user.username}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:user.email}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:user.isAdmin?'管理员':'普通用户'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsx(\"span\",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.status==='active'?'bg-green-100 text-green-800':user.status==='suspended'?'bg-red-100 text-red-800':'bg-gray-100 text-gray-800'}`,children:user.status==='active'?'活跃':user.status==='suspended'?'已停用':'未激活'})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:formatDate(user.createdAt)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:user.lastLogin?formatDate(user.lastLogin):'从未登录'})]},user._id)),users.length===0&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",className:\"px-6 py-4 text-center text-sm text-gray-500\",children:\"\\u6CA1\\u6709\\u7528\\u6237\\u6570\\u636E\"})})]})]})}),activeTab==='logs'&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow overflow-hidden sm:rounded-lg\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u7528\\u6237\\u540D\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u64CD\\u4F5C\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u7528\\u6237\\u7C7B\\u578B\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u72B6\\u6001\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"IP\\u5730\\u5740\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u65F6\\u95F4\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:[logs.map(log=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\",children:log.username}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:log.action==='login'?'登录':log.action==='register'?'注册':log.action==='logout'?'登出':'密码重置'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:log.userType==='admin'?'管理员':'普通用户'}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:[/*#__PURE__*/_jsx(\"span\",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${log.successful?'bg-green-100 text-green-800':'bg-red-100 text-red-800'}`,children:log.successful?'成功':'失败'}),!log.successful&&log.failureReason&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-xs text-red-600\",children:[\"(\",log.failureReason,\")\"]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:log.ipAddress||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:formatDate(log.timestamp)})]},log._id)),logs.length===0&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",className:\"px-6 py-4 text-center text-sm text-gray-500\",children:\"\\u6CA1\\u6709\\u65E5\\u5FD7\\u6570\\u636E\"})})]})]})})]})]})}),editingUser&&/*#__PURE__*/_jsx(UserEditModal,{user:editingUser,onClose:()=>setEditingUser(null),onSave:handleSaveUser})]});};export default AdminDashboard;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useAuth","UserEditModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AdminDashboard","userInfo","logout","authFetch","activeTab","setActiveTab","users","setUsers","logs","setLogs","loading","setLoading","error","setError","editingUser","setEditingUser","navigate","console","log","isAdmin","fetchData","tab","fetchUsers","fetchLogs","err","message","includes","response","ok","data","json","status","Error","formatDate","dateString","date","Date","toLocaleString","handleSaveUser","updatedData","_id","method","headers","body","JSON","stringify","className","children","username","onClick","scope","map","user","email","createdAt","lastLogin","length","colSpan","action","userType","successful","failureReason","ipAddress","timestamp","onClose","onSave"],"sources":["D:/软件工程/智慧海洋牧场可视化系统/frontend/src/pages/AdminDashboard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport UserEditModal from '../components/UserEditModal';\r\n\r\nconst AdminDashboard = () => {\r\n  const { userInfo, logout, authFetch } = useAuth();\r\n  const [activeTab, setActiveTab] = useState('users');\r\n  const [users, setUsers] = useState([]);\r\n  const [logs, setLogs] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [editingUser, setEditingUser] = useState(null);\r\n  const navigate = useNavigate(); // 添加导航钩子\r\n\r\n  useEffect(() => {\r\n    console.log('AdminDashboard - 当前用户:', userInfo);\r\n    \r\n    // 立即检查用户权限\r\n    if (!userInfo || !userInfo.isAdmin) {\r\n      console.log('AdminDashboard - 非管理员访问，重定向到用户仪表板');\r\n      navigate('/user-dashboard');\r\n      return;\r\n    }\r\n    \r\n    fetchData(activeTab);\r\n  }, [activeTab, navigate, userInfo]);\r\n\r\n  const fetchData = async (tab) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      if (tab === 'users') {\r\n        await fetchUsers();\r\n      } else if (tab === 'logs') {\r\n        await fetchLogs();\r\n      }\r\n    } catch (err) {\r\n      console.error('获取数据失败:', err);\r\n      setError(err.message || '获取数据失败');\r\n      \r\n      // 检查是否是权限问题(403)\r\n      if (err.message.includes('权限') || err.message.includes('访问被拒绝')) {\r\n        console.log('权限被拒绝，重定向到用户仪表板');\r\n        navigate('/user-dashboard');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchUsers = async () => {\r\n    const response = await authFetch('/api/users');\r\n    if (!response.ok) {\r\n      const data = await response.json();\r\n      \r\n      // 特别处理403错误\r\n      if (response.status === 403) {\r\n        console.log('管理员API访问被拒绝，重定向到用户仪表板');\r\n        navigate('/user-dashboard');\r\n      }\r\n      \r\n      throw new Error(data.message || '获取用户列表失败');\r\n    }\r\n    const data = await response.json();\r\n    setUsers(data);\r\n  };\r\n\r\n  const fetchLogs = async () => {\r\n    const response = await authFetch('/api/logs');\r\n    if (!response.ok) {\r\n      const data = await response.json();\r\n      \r\n      // 特别处理403错误\r\n      if (response.status === 403) {\r\n        console.log('管理员API访问被拒绝，重定向到用户仪表板');\r\n        navigate('/user-dashboard');\r\n      }\r\n      \r\n      throw new Error(data.message || '获取日志失败');\r\n    }\r\n    const data = await response.json();\r\n    setLogs(data);\r\n  };\r\n\r\n  const formatDate = (dateString) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleString('zh-CN');\r\n  };\r\n\r\n  const handleSaveUser = async (updatedData) => {\r\n    try {\r\n      const response = await authFetch(`/api/users/${editingUser._id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(updatedData)\r\n      });\r\n  \r\n      // 防御性检查\r\n      if (!response || !response.json) {\r\n        throw new Error('无效的服务器响应');\r\n      }\r\n  \r\n      const data = await response.json();\r\n  \r\n      if (!response.ok) {\r\n        throw new Error(data.message || `请求失败 (${response.status})`);\r\n      }\r\n  \r\n      await fetchUsers();\r\n      setEditingUser(null);\r\n    } catch (err) {\r\n      setError(err.message);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-100\">\r\n      <nav className=\"bg-indigo-600 shadow-md\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex justify-between h-16\">\r\n            <div className=\"flex items-center\">\r\n              <h1 className=\"text-xl font-bold text-white\">管理员控制面板</h1>\r\n            </div>\r\n            <div className=\"flex items-center\">\r\n              <span className=\"text-white mr-4\">管理员：{userInfo.username}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n      \r\n      <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\r\n        <div className=\"px-4 py-6 sm:px-0\">\r\n          <div className=\"mb-6\">\r\n            <div className=\"flex border-b border-gray-200\">\r\n              <button\r\n                className={`py-2 px-4 font-medium text-sm ${\r\n                  activeTab === 'users'\r\n                    ? 'border-b-2 border-indigo-500 text-indigo-600'\r\n                    : 'text-gray-500 hover:text-gray-700'\r\n                }`}\r\n                onClick={() => setActiveTab('users')}\r\n              >\r\n                用户管理\r\n              </button>\r\n              <button\r\n                className={`py-2 px-4 font-medium text-sm ${\r\n                  activeTab === 'logs'\r\n                    ? 'border-b-2 border-indigo-500 text-indigo-600'\r\n                    : 'text-gray-500 hover:text-gray-700'\r\n                }`}\r\n                onClick={() => setActiveTab('logs')}\r\n              >\r\n                系统日志\r\n              </button>\r\n            </div>\r\n          </div>\r\n          \r\n          {loading ? (\r\n            <div className=\"flex justify-center items-center h-64\">\r\n              <p className=\"text-gray-500\">加载中...</p>\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded\">\r\n              <p>{error}</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              {activeTab === 'users' && (\r\n                <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\r\n                  <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                      <tr>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          用户名\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          邮箱\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          角色\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          状态\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          注册时间\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          最后登录\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                      {users.map((user) => (\r\n                        \r\n                        <tr \r\n                        key={user._id}\r\n                        onClick={() => setEditingUser(user)}\r\n                        className=\"hover:bg-gray-50 cursor-pointer transition-colors\"\r\n                        >\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                            {user.username}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {user.email}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {user.isAdmin ? '管理员' : '普通用户'}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                              user.status === 'active' ? 'bg-green-100 text-green-800' : \r\n                              user.status === 'suspended' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'\r\n                            }`}>\r\n                              {user.status === 'active' ? '活跃' : \r\n                               user.status === 'suspended' ? '已停用' : '未激活'}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {formatDate(user.createdAt)}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {user.lastLogin ? formatDate(user.lastLogin) : '从未登录'}\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                      {users.length === 0 && (\r\n                        <tr>\r\n                          <td colSpan=\"6\" className=\"px-6 py-4 text-center text-sm text-gray-500\">\r\n                            没有用户数据\r\n                          </td>\r\n                        </tr>\r\n                      )}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              )}\r\n              \r\n              {activeTab === 'logs' && (\r\n                <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\r\n                  <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                      <tr>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          用户名\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          操作\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          用户类型\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          状态\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          IP地址\r\n                        </th>\r\n                        <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                          时间\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                      {logs.map((log) => (\r\n                        <tr key={log._id}>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                            {log.username}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {log.action === 'login' ? '登录' : \r\n                             log.action === 'register' ? '注册' : \r\n                             log.action === 'logout' ? '登出' : '密码重置'}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {log.userType === 'admin' ? '管理员' : '普通用户'}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                              log.successful ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\r\n                            }`}>\r\n                              {log.successful ? '成功' : '失败'}\r\n                            </span>\r\n                            {!log.successful && log.failureReason && (\r\n                              <span className=\"ml-2 text-xs text-red-600\">\r\n                                ({log.failureReason})\r\n                              </span>\r\n                            )}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {log.ipAddress || '-'}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {formatDate(log.timestamp)}\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                      {logs.length === 0 && (\r\n                        <tr>\r\n                          <td colSpan=\"6\" className=\"px-6 py-4 text-center text-sm text-gray-500\">\r\n                            没有日志数据\r\n                          </td>\r\n                        </tr>\r\n                      )}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </main>\r\n      {editingUser && (\r\n      <UserEditModal\r\n        user={editingUser}\r\n        onClose={() => setEditingUser(null)}\r\n        onSave={handleSaveUser}\r\n      />\r\n    )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminDashboard;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,OAAO,KAAQ,wBAAwB,CAChD,MAAO,CAAAC,aAAa,KAAM,6BAA6B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAExD,KAAM,CAAAC,cAAc,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAAEC,QAAQ,CAAEC,MAAM,CAAEC,SAAU,CAAC,CAAGX,OAAO,CAAC,CAAC,CACjD,KAAM,CAACY,SAAS,CAAEC,YAAY,CAAC,CAAGhB,QAAQ,CAAC,OAAO,CAAC,CACnD,KAAM,CAACiB,KAAK,CAAEC,QAAQ,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACmB,IAAI,CAAEC,OAAO,CAAC,CAAGpB,QAAQ,CAAC,EAAE,CAAC,CACpC,KAAM,CAACqB,OAAO,CAAEC,UAAU,CAAC,CAAGtB,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACuB,KAAK,CAAEC,QAAQ,CAAC,CAAGxB,QAAQ,CAAC,IAAI,CAAC,CACxC,KAAM,CAACyB,WAAW,CAAEC,cAAc,CAAC,CAAG1B,QAAQ,CAAC,IAAI,CAAC,CACpD,KAAM,CAAA2B,QAAQ,CAAGzB,WAAW,CAAC,CAAC,CAAE;AAEhCD,SAAS,CAAC,IAAM,CACd2B,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEjB,QAAQ,CAAC,CAE/C;AACA,GAAI,CAACA,QAAQ,EAAI,CAACA,QAAQ,CAACkB,OAAO,CAAE,CAClCF,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC,CAChDF,QAAQ,CAAC,iBAAiB,CAAC,CAC3B,OACF,CAEAI,SAAS,CAAChB,SAAS,CAAC,CACtB,CAAC,CAAE,CAACA,SAAS,CAAEY,QAAQ,CAAEf,QAAQ,CAAC,CAAC,CAEnC,KAAM,CAAAmB,SAAS,CAAG,KAAO,CAAAC,GAAG,EAAK,CAC/BV,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAAC,IAAI,CAAC,CAEd,GAAI,CACF,GAAIQ,GAAG,GAAK,OAAO,CAAE,CACnB,KAAM,CAAAC,UAAU,CAAC,CAAC,CACpB,CAAC,IAAM,IAAID,GAAG,GAAK,MAAM,CAAE,CACzB,KAAM,CAAAE,SAAS,CAAC,CAAC,CACnB,CACF,CAAE,MAAOC,GAAG,CAAE,CACZP,OAAO,CAACL,KAAK,CAAC,SAAS,CAAEY,GAAG,CAAC,CAC7BX,QAAQ,CAACW,GAAG,CAACC,OAAO,EAAI,QAAQ,CAAC,CAEjC;AACA,GAAID,GAAG,CAACC,OAAO,CAACC,QAAQ,CAAC,IAAI,CAAC,EAAIF,GAAG,CAACC,OAAO,CAACC,QAAQ,CAAC,OAAO,CAAC,CAAE,CAC/DT,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC,CAC9BF,QAAQ,CAAC,iBAAiB,CAAC,CAC7B,CACF,CAAC,OAAS,CACRL,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAW,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,KAAM,CAAAK,QAAQ,CAAG,KAAM,CAAAxB,SAAS,CAAC,YAAY,CAAC,CAC9C,GAAI,CAACwB,QAAQ,CAACC,EAAE,CAAE,CAChB,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAF,QAAQ,CAACG,IAAI,CAAC,CAAC,CAElC;AACA,GAAIH,QAAQ,CAACI,MAAM,GAAK,GAAG,CAAE,CAC3Bd,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC,CACpCF,QAAQ,CAAC,iBAAiB,CAAC,CAC7B,CAEA,KAAM,IAAI,CAAAgB,KAAK,CAACH,IAAI,CAACJ,OAAO,EAAI,UAAU,CAAC,CAC7C,CACA,KAAM,CAAAI,IAAI,CAAG,KAAM,CAAAF,QAAQ,CAACG,IAAI,CAAC,CAAC,CAClCvB,QAAQ,CAACsB,IAAI,CAAC,CAChB,CAAC,CAED,KAAM,CAAAN,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAAxB,SAAS,CAAC,WAAW,CAAC,CAC7C,GAAI,CAACwB,QAAQ,CAACC,EAAE,CAAE,CAChB,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAF,QAAQ,CAACG,IAAI,CAAC,CAAC,CAElC;AACA,GAAIH,QAAQ,CAACI,MAAM,GAAK,GAAG,CAAE,CAC3Bd,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC,CACpCF,QAAQ,CAAC,iBAAiB,CAAC,CAC7B,CAEA,KAAM,IAAI,CAAAgB,KAAK,CAACH,IAAI,CAACJ,OAAO,EAAI,QAAQ,CAAC,CAC3C,CACA,KAAM,CAAAI,IAAI,CAAG,KAAM,CAAAF,QAAQ,CAACG,IAAI,CAAC,CAAC,CAClCrB,OAAO,CAACoB,IAAI,CAAC,CACf,CAAC,CAED,KAAM,CAAAI,UAAU,CAAIC,UAAU,EAAK,CACjC,KAAM,CAAAC,IAAI,CAAG,GAAI,CAAAC,IAAI,CAACF,UAAU,CAAC,CACjC,MAAO,CAAAC,IAAI,CAACE,cAAc,CAAC,OAAO,CAAC,CACrC,CAAC,CAED,KAAM,CAAAC,cAAc,CAAG,KAAO,CAAAC,WAAW,EAAK,CAC5C,GAAI,CACF,KAAM,CAAAZ,QAAQ,CAAG,KAAM,CAAAxB,SAAS,CAAC,cAAcW,WAAW,CAAC0B,GAAG,EAAE,CAAE,CAChEC,MAAM,CAAE,KAAK,CACbC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACN,WAAW,CAClC,CAAC,CAAC,CAEF;AACA,GAAI,CAACZ,QAAQ,EAAI,CAACA,QAAQ,CAACG,IAAI,CAAE,CAC/B,KAAM,IAAI,CAAAE,KAAK,CAAC,UAAU,CAAC,CAC7B,CAEA,KAAM,CAAAH,IAAI,CAAG,KAAM,CAAAF,QAAQ,CAACG,IAAI,CAAC,CAAC,CAElC,GAAI,CAACH,QAAQ,CAACC,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAI,KAAK,CAACH,IAAI,CAACJ,OAAO,EAAI,SAASE,QAAQ,CAACI,MAAM,GAAG,CAAC,CAC9D,CAEA,KAAM,CAAAT,UAAU,CAAC,CAAC,CAClBP,cAAc,CAAC,IAAI,CAAC,CACtB,CAAE,MAAOS,GAAG,CAAE,CACZX,QAAQ,CAACW,GAAG,CAACC,OAAO,CAAC,CACvB,CACF,CAAC,CAED,mBACE5B,KAAA,QAAKiD,SAAS,CAAC,0BAA0B,CAAAC,QAAA,eACvCpD,IAAA,QAAKmD,SAAS,CAAC,yBAAyB,CAAAC,QAAA,cACtCpD,IAAA,QAAKmD,SAAS,CAAC,wCAAwC,CAAAC,QAAA,cACrDlD,KAAA,QAAKiD,SAAS,CAAC,2BAA2B,CAAAC,QAAA,eACxCpD,IAAA,QAAKmD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,cAChCpD,IAAA,OAAImD,SAAS,CAAC,8BAA8B,CAAAC,QAAA,CAAC,4CAAO,CAAI,CAAC,CACtD,CAAC,cACNpD,IAAA,QAAKmD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,cAChClD,KAAA,SAAMiD,SAAS,CAAC,iBAAiB,CAAAC,QAAA,EAAC,0BAAI,CAAC9C,QAAQ,CAAC+C,QAAQ,EAAO,CAAC,CAC7D,CAAC,EACH,CAAC,CACH,CAAC,CACH,CAAC,cAENrD,IAAA,SAAMmD,SAAS,CAAC,wCAAwC,CAAAC,QAAA,cACtDlD,KAAA,QAAKiD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAChCpD,IAAA,QAAKmD,SAAS,CAAC,MAAM,CAAAC,QAAA,cACnBlD,KAAA,QAAKiD,SAAS,CAAC,+BAA+B,CAAAC,QAAA,eAC5CpD,IAAA,WACEmD,SAAS,CAAE,iCACT1C,SAAS,GAAK,OAAO,CACjB,8CAA8C,CAC9C,mCAAmC,EACtC,CACH6C,OAAO,CAAEA,CAAA,GAAM5C,YAAY,CAAC,OAAO,CAAE,CAAA0C,QAAA,CACtC,0BAED,CAAQ,CAAC,cACTpD,IAAA,WACEmD,SAAS,CAAE,iCACT1C,SAAS,GAAK,MAAM,CAChB,8CAA8C,CAC9C,mCAAmC,EACtC,CACH6C,OAAO,CAAEA,CAAA,GAAM5C,YAAY,CAAC,MAAM,CAAE,CAAA0C,QAAA,CACrC,0BAED,CAAQ,CAAC,EACN,CAAC,CACH,CAAC,CAELrC,OAAO,cACNf,IAAA,QAAKmD,SAAS,CAAC,uCAAuC,CAAAC,QAAA,cACpDpD,IAAA,MAAGmD,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAC,uBAAM,CAAG,CAAC,CACpC,CAAC,CACJnC,KAAK,cACPjB,IAAA,QAAKmD,SAAS,CAAC,iEAAiE,CAAAC,QAAA,cAC9EpD,IAAA,MAAAoD,QAAA,CAAInC,KAAK,CAAI,CAAC,CACX,CAAC,cAENf,KAAA,CAAAE,SAAA,EAAAgD,QAAA,EACG3C,SAAS,GAAK,OAAO,eACpBT,IAAA,QAAKmD,SAAS,CAAC,+CAA+C,CAAAC,QAAA,cAC5DlD,KAAA,UAAOiD,SAAS,CAAC,qCAAqC,CAAAC,QAAA,eACpDpD,IAAA,UAAOmD,SAAS,CAAC,YAAY,CAAAC,QAAA,cAC3BlD,KAAA,OAAAkD,QAAA,eACEpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,oBAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,cAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,cAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,cAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,0BAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,0BAE3G,CAAI,CAAC,EACH,CAAC,CACA,CAAC,cACRlD,KAAA,UAAOiD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,EACjDzC,KAAK,CAAC6C,GAAG,CAAEC,IAAI,eAEdvD,KAAA,OAEAoD,OAAO,CAAEA,CAAA,GAAMlC,cAAc,CAACqC,IAAI,CAAE,CACpCN,SAAS,CAAC,mDAAmD,CAAAC,QAAA,eAE3DpD,IAAA,OAAImD,SAAS,CAAC,+DAA+D,CAAAC,QAAA,CAC1EK,IAAI,CAACJ,QAAQ,CACZ,CAAC,cACLrD,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9DK,IAAI,CAACC,KAAK,CACT,CAAC,cACL1D,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9DK,IAAI,CAACjC,OAAO,CAAG,KAAK,CAAG,MAAM,CAC5B,CAAC,cACLxB,IAAA,OAAImD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,cACzCpD,IAAA,SAAMmD,SAAS,CAAE,iEACfM,IAAI,CAACrB,MAAM,GAAK,QAAQ,CAAG,6BAA6B,CACxDqB,IAAI,CAACrB,MAAM,GAAK,WAAW,CAAG,yBAAyB,CAAG,2BAA2B,EACpF,CAAAgB,QAAA,CACAK,IAAI,CAACrB,MAAM,GAAK,QAAQ,CAAG,IAAI,CAC/BqB,IAAI,CAACrB,MAAM,GAAK,WAAW,CAAG,KAAK,CAAG,KAAK,CACxC,CAAC,CACL,CAAC,cACLpC,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9Dd,UAAU,CAACmB,IAAI,CAACE,SAAS,CAAC,CACzB,CAAC,cACL3D,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9DK,IAAI,CAACG,SAAS,CAAGtB,UAAU,CAACmB,IAAI,CAACG,SAAS,CAAC,CAAG,MAAM,CACnD,CAAC,GA3BFH,IAAI,CAACZ,GA4BN,CACL,CAAC,CACDlC,KAAK,CAACkD,MAAM,GAAK,CAAC,eACjB7D,IAAA,OAAAoD,QAAA,cACEpD,IAAA,OAAI8D,OAAO,CAAC,GAAG,CAACX,SAAS,CAAC,6CAA6C,CAAAC,QAAA,CAAC,sCAExE,CAAI,CAAC,CACH,CACL,EACI,CAAC,EACH,CAAC,CACL,CACN,CAEA3C,SAAS,GAAK,MAAM,eACnBT,IAAA,QAAKmD,SAAS,CAAC,+CAA+C,CAAAC,QAAA,cAC5DlD,KAAA,UAAOiD,SAAS,CAAC,qCAAqC,CAAAC,QAAA,eACpDpD,IAAA,UAAOmD,SAAS,CAAC,YAAY,CAAAC,QAAA,cAC3BlD,KAAA,OAAAkD,QAAA,eACEpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,oBAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,cAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,0BAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,cAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,gBAE3G,CAAI,CAAC,cACLpD,IAAA,OAAIuD,KAAK,CAAC,KAAK,CAACJ,SAAS,CAAC,gFAAgF,CAAAC,QAAA,CAAC,cAE3G,CAAI,CAAC,EACH,CAAC,CACA,CAAC,cACRlD,KAAA,UAAOiD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,EACjDvC,IAAI,CAAC2C,GAAG,CAAEjC,GAAG,eACZrB,KAAA,OAAAkD,QAAA,eACEpD,IAAA,OAAImD,SAAS,CAAC,+DAA+D,CAAAC,QAAA,CAC1E7B,GAAG,CAAC8B,QAAQ,CACX,CAAC,cACLrD,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9D7B,GAAG,CAACwC,MAAM,GAAK,OAAO,CAAG,IAAI,CAC7BxC,GAAG,CAACwC,MAAM,GAAK,UAAU,CAAG,IAAI,CAChCxC,GAAG,CAACwC,MAAM,GAAK,QAAQ,CAAG,IAAI,CAAG,MAAM,CACtC,CAAC,cACL/D,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9D7B,GAAG,CAACyC,QAAQ,GAAK,OAAO,CAAG,KAAK,CAAG,MAAM,CACxC,CAAC,cACL9D,KAAA,OAAIiD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,eACzCpD,IAAA,SAAMmD,SAAS,CAAE,iEACf5B,GAAG,CAAC0C,UAAU,CAAG,6BAA6B,CAAG,yBAAyB,EACzE,CAAAb,QAAA,CACA7B,GAAG,CAAC0C,UAAU,CAAG,IAAI,CAAG,IAAI,CACzB,CAAC,CACN,CAAC1C,GAAG,CAAC0C,UAAU,EAAI1C,GAAG,CAAC2C,aAAa,eACnChE,KAAA,SAAMiD,SAAS,CAAC,2BAA2B,CAAAC,QAAA,EAAC,GACzC,CAAC7B,GAAG,CAAC2C,aAAa,CAAC,GACtB,EAAM,CACP,EACC,CAAC,cACLlE,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9D7B,GAAG,CAAC4C,SAAS,EAAI,GAAG,CACnB,CAAC,cACLnE,IAAA,OAAImD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC9Dd,UAAU,CAACf,GAAG,CAAC6C,SAAS,CAAC,CACxB,CAAC,GA7BE7C,GAAG,CAACsB,GA8BT,CACL,CAAC,CACDhC,IAAI,CAACgD,MAAM,GAAK,CAAC,eAChB7D,IAAA,OAAAoD,QAAA,cACEpD,IAAA,OAAI8D,OAAO,CAAC,GAAG,CAACX,SAAS,CAAC,6CAA6C,CAAAC,QAAA,CAAC,sCAExE,CAAI,CAAC,CACH,CACL,EACI,CAAC,EACH,CAAC,CACL,CACN,EACD,CACH,EACE,CAAC,CACF,CAAC,CACNjC,WAAW,eACZnB,IAAA,CAACF,aAAa,EACZ2D,IAAI,CAAEtC,WAAY,CAClBkD,OAAO,CAAEA,CAAA,GAAMjD,cAAc,CAAC,IAAI,CAAE,CACpCkD,MAAM,CAAE3B,cAAe,CACxB,CACF,EACI,CAAC,CAEV,CAAC,CAED,cAAe,CAAAtC,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}