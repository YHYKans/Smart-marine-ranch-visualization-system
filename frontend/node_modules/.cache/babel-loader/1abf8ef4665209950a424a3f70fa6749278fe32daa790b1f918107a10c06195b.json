{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u8F6F\\u4EF6\\u5DE5\\u7A0B\\\\\\u667A\\u6167\\u6D77\\u6D0B\\u7267\\u573A\\u53EF\\u89C6\\u5316\\u7CFB\\u7EDF\\\\frontend\\\\src\\\\pages\\\\Underwater.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { Row, Col, Card, Select, Button, Spin, message } from 'antd';\nimport { Line, Pie } from 'react-chartjs-2';\nimport moment from 'moment';\nimport Chart from 'chart.js/auto'; // 自动注册所有组件\nimport { DownloadOutlined } from '@ant-design/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Option\n} = Select;\nconst transformChartData = (backendData, chartType) => {\n  if (!backendData) return null;\n  if (chartType === 'line') {\n    return {\n      labels: backendData.x || [],\n      datasets: (backendData.datasets || []).map(dataset => ({\n        ...dataset,\n        data: dataset.data || []\n      }))\n    };\n  }\n  if (chartType === 'pie') {\n    return {\n      labels: backendData.labels || [],\n      datasets: [{\n        data: backendData.values || [],\n        backgroundColor: backendData.backgroundColor || ['rgba(54, 162, 235, 0.7)', 'rgba(255, 99, 132, 0.7)', 'rgba(255, 206, 86, 0.7)', 'rgba(75, 192, 192, 0.7)', 'rgba(153, 102, 255, 0.7)', 'rgba(255, 159, 64, 0.7)'],\n        borderColor: backendData.borderColor || ['rgb(54, 162, 235)', 'rgb(255, 99, 132)', 'rgb(255, 206, 86)', 'rgb(75, 192, 192)', 'rgb(153, 102, 255)', 'rgb(255, 159, 64)'],\n        borderWidth: backendData.borderWidth || 1\n      }]\n    };\n  }\n  return null;\n};\nfunction Underwater() {\n  _s();\n  // 定义日期范围常量\n  const minDate = '2020-05-08';\n  const maxDate = '2021-04-05';\n  const [selectedDate, setSelectedDate] = useState(minDate); // 使用minDate初始化\n  const [lineChartData, setLineChartData] = useState(null);\n  const [pieChartData, setPieChartData] = useState(null);\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [selectedMetric, setSelectedMetric] = useState('');\n  const [availableMetrics, setAvailableMetrics] = useState(['断面名称', '水温(℃)', 'pH(无量纲)', '溶解氧(mg/L)', '电导率(μS/cm)', '浊度(NTU)', '高锰酸盐指数(mg/L)', '氨氮(mg/L)', '总磷(mg/L)', '总氮(mg/L)', '叶绿素α(mg/L)', '藻密度(cells/L)']);\n  const [chartLoaded, setChartLoaded] = useState({\n    line: false,\n    pie: false\n  });\n\n  // 用于存储Chart实例的引用\n  const lineChartRef = useRef(null);\n  const pieChartRef = useRef(null);\n  const generateFilePath = dateString => {\n    const date = new Date(dateString);\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `config/软件工程大作业数据/水质数据/${year}-${month}/${year}-${month}-${day}.json`;\n  };\n\n  // 下载图表为图片\n  const downloadChartAsImage = useCallback((chartRef, chartName, chartType) => {\n    console.log(`下载${chartType}图表:`, chartName);\n    if (!chartRef.current) {\n      message.warning('图表尚未加载完成');\n      return;\n    }\n\n    // 使用 setTimeout 确保图表完全渲染\n    setTimeout(() => {\n      try {\n        let chartInstance;\n\n        // 方式 1: 直接访问 chartInstance 属性\n        if (chartRef.current.chartInstance) {\n          chartInstance = chartRef.current.chartInstance;\n        }\n        // 方式 2: 通过 canvas 元素获取\n        else if (chartRef.current.canvas) {\n          const canvas = chartRef.current.canvas;\n          chartInstance = Chart.getChart(canvas);\n        }\n        if (!chartInstance) {\n          console.error(`无法获取${chartType}图表实例`);\n          message.warning({\n            content: '图表加载中，请稍后再试',\n            key: `chart-${chartType}-not-ready`,\n            duration: 2\n          });\n          return;\n        }\n\n        // 生成图片并下载\n        const imgData = chartInstance.toBase64Image('image/png', 1.0);\n        const link = document.createElement('a');\n        link.download = `${chartName}.png`;\n        link.href = imgData;\n        link.click();\n        message.success({\n          content: `${chartName} 下载成功`,\n          key: `download-success-${chartType}`,\n          duration: 2\n        });\n      } catch (error) {\n        console.error(`下载${chartType}图表失败:`, error);\n        message.error({\n          content: '下载图表失败，请重试',\n          key: `download-error-${chartType}`,\n          duration: 3\n        });\n      }\n    }, 300); // 延迟 300ms 确保图表渲染完成\n  }, []);\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n    setChartLoaded({\n      line: false,\n      pie: false\n    }); // 重置图表加载状态\n\n    try {\n      const filePath = generateFilePath(selectedDate);\n      const response = await fetch('http://localhost:3001/visualize-water', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          file_path: filePath,\n          target_column: selectedMetric\n        })\n      });\n      if (!response.ok) throw new Error(await response.text());\n      const data = await response.json();\n      console.log('后端数据:', data);\n      if (data.error) throw new Error(data.error);\n\n      // 转换数据格式\n      setLineChartData(transformChartData(data.line_chart_data, 'line'));\n      setPieChartData(transformChartData(data.pie_chart_data, 'pie'));\n      setAvailableMetrics(data.available_metrics || availableMetrics);\n    } catch (err) {\n      setError(err.message);\n      message.error(err.message);\n      setLineChartData(null);\n      setPieChartData(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const formatDate = dateString => {\n    return moment(dateString).format('YYYY年MM月DD日');\n  };\n\n  // 组件卸载时销毁Chart实例\n  useEffect(() => {\n    return () => {\n      if (lineChartRef.current) {\n        lineChartRef.current.destroy();\n      }\n      if (pieChartRef.current) {\n        pieChartRef.current.destroy();\n      }\n    };\n  }, []);\n\n  // 数据更新时更新Chart实例\n  useEffect(() => {\n    if (lineChartData && lineChartRef.current) {\n      if (lineChartRef.current.chartInstance) {\n        lineChartRef.current.chartInstance.data = lineChartData;\n        lineChartRef.current.chartInstance.update();\n        setChartLoaded(prev => ({\n          ...prev,\n          line: true\n        }));\n      }\n    }\n    if (pieChartData && pieChartRef.current) {\n      if (pieChartRef.current.chartInstance) {\n        pieChartRef.current.chartInstance.data = pieChartData;\n        pieChartRef.current.chartInstance.update();\n        setChartLoaded(prev => ({\n          ...prev,\n          pie: true\n        }));\n      }\n    }\n  }, [lineChartData, pieChartData]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '30px',\n      backgroundColor: '#f0f2f5'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      style: {\n        textAlign: 'center',\n        color: '#1890ff',\n        marginBottom: '40px',\n        fontSize: '2.5rem',\n        fontWeight: '600',\n        textShadow: '0 2px 4px rgba(0,0,0,0.1)'\n      },\n      children: \"\\u6C34\\u4E0B\\u73AF\\u5883\\u76D1\\u6D4B\\u53EF\\u89C6\\u5316\\u7CFB\\u7EDF\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Spin, {\n      spinning: isLoading,\n      tip: \"\\u6B63\\u5728\\u5206\\u6790\\u6C34\\u8D28\\u6570\\u636E...\",\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        style: {\n          marginBottom: '40px'\n        },\n        children: /*#__PURE__*/_jsxDEV(Row, {\n          gutter: 24,\n          justify: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(Col, {\n            xs: 24,\n            sm: 12,\n            md: 8,\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"date\",\n              value: selectedDate,\n              onChange: e => setSelectedDate(e.target.value),\n              min: minDate,\n              max: maxDate,\n              style: {\n                width: '100%',\n                padding: '12px 16px',\n                border: '1px solid #d9d9d9',\n                borderRadius: '8px',\n                fontSize: '16px',\n                boxShadow: '0 1px 3px rgba(0,0,0,0.05)'\n              },\n              placeholder: \"\\u9009\\u62E9\\u65E5\\u671F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                display: 'block',\n                marginTop: '12px',\n                color: '#666',\n                fontSize: '14px'\n              },\n              children: [\"\\u9009\\u62E9\\u65E5\\u671F: \", formatDate(selectedDate)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Col, {\n            xs: 24,\n            sm: 12,\n            md: 8,\n            children: /*#__PURE__*/_jsxDEV(Select, {\n              value: selectedMetric,\n              onChange: value => setSelectedMetric(value),\n              style: {\n                width: '100%',\n                height: '52px',\n                fontSize: '16px'\n              },\n              placeholder: \"\\u9009\\u62E9\\u76D1\\u6D4B\\u6307\\u6807\",\n              children: [/*#__PURE__*/_jsxDEV(Option, {\n                value: \"\",\n                children: \"\\u663E\\u793A\\u5168\\u90E8\\u6307\\u6807\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 268,\n                columnNumber: 17\n              }, this), availableMetrics.map((metric, index) => /*#__PURE__*/_jsxDEV(Option, {\n                value: metric,\n                children: metric\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 19\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Col, {\n            xs: 24,\n            sm: 24,\n            md: 8,\n            style: {\n              textAlign: 'center',\n              marginTop: '32px'\n            },\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              type: \"primary\",\n              size: \"large\",\n              onClick: handleSubmit,\n              loading: isLoading,\n              style: {\n                width: '200px',\n                height: '56px',\n                fontSize: '18px',\n                fontWeight: '500',\n                backgroundColor: '#1890ff',\n                borderColor: '#1890ff',\n                boxShadow: '0 4px 12px rgba(24, 144, 255, 0.3)',\n                borderRadius: '8px',\n                transition: 'all 0.3s ease'\n              },\n              hoverStyle: {\n                backgroundColor: '#0d75aa',\n                borderColor: '#0d75aa',\n                boxShadow: '0 6px 16px rgba(24, 144, 255, 0.4)'\n              },\n              children: isLoading ? '数据生成中...' : '开始可视化分析'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(Card, {\n        style: {\n          marginBottom: '20px',\n          borderColor: '#f5222d'\n        },\n        title: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: '#f5222d'\n          },\n          children: \"\\u26A0\\uFE0F \\u9519\\u8BEF\\u63D0\\u793A\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 20\n        }, this),\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#f5222d'\n          },\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Row, {\n        gutter: 16,\n        children: [lineChartData && /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          md: 12,\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            title: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u6C34\\u8D28\\u53C2\\u6570\\u8D8B\\u52BF\\u5206\\u6790\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 319,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                icon: /*#__PURE__*/_jsxDEV(DownloadOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 321,\n                  columnNumber: 29\n                }, this),\n                size: \"small\",\n                onClick: () => downloadChartAsImage(lineChartRef, '水质参数趋势分析图', 'line'),\n                disabled: !chartLoaded.line,\n                children: \"\\u4E0B\\u8F7D\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 318,\n              columnNumber: 19\n            }, this),\n            bordered: true,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                height: '400px'\n              },\n              children: /*#__PURE__*/_jsxDEV(Line, {\n                ref: lineChartRef,\n                data: lineChartData,\n                options: {\n                  responsive: true,\n                  maintainAspectRatio: false,\n                  interaction: {\n                    intersect: false,\n                    mode: 'index'\n                  },\n                  plugins: {\n                    legend: {\n                      position: 'top'\n                    },\n                    tooltip: {\n                      callbacks: {\n                        label: context => {\n                          return `${context.dataset.label}: ${context.parsed.y}`;\n                        }\n                      }\n                    }\n                  },\n                  scales: {\n                    x: {\n                      title: {\n                        display: true,\n                        text: '时间'\n                      }\n                    },\n                    y: {\n                      title: {\n                        display: true,\n                        text: '数值'\n                      }\n                    }\n                  }\n                },\n                onRender: chart => {\n                  console.log('折线图渲染完成');\n                  setChartLoaded(prev => ({\n                    ...prev,\n                    line: true\n                  }));\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 333,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 13\n        }, this), pieChartData && /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          md: 12,\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            title: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u6C34\\u8D28\\u7C7B\\u522B\\u5206\\u5E03\\u7EDF\\u8BA1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 385,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                icon: /*#__PURE__*/_jsxDEV(DownloadOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 387,\n                  columnNumber: 29\n                }, this),\n                size: \"small\",\n                onClick: () => downloadChartAsImage(pieChartRef, '水质类别分布统计图', 'pie'),\n                disabled: !chartLoaded.pie,\n                children: \"\\u4E0B\\u8F7D\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 386,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 19\n            }, this),\n            bordered: true,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                height: '400px',\n                position: 'relative'\n              },\n              children: /*#__PURE__*/_jsxDEV(Pie, {\n                ref: pieChartRef,\n                data: pieChartData,\n                options: {\n                  responsive: true,\n                  maintainAspectRatio: false,\n                  layout: {\n                    padding: {\n                      top: 20,\n                      bottom: 20,\n                      left: 20,\n                      right: 20\n                    }\n                  },\n                  plugins: {\n                    legend: {\n                      position: 'right',\n                      labels: {\n                        font: {\n                          size: 12\n                        }\n                      }\n                    }\n                  }\n                },\n                onRender: chart => {\n                  console.log('饼图渲染完成');\n                  setChartLoaded(prev => ({\n                    ...prev,\n                    pie: true\n                  }));\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 399,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 398,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 382,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 215,\n    columnNumber: 5\n  }, this);\n}\n_s(Underwater, \"GmcbAjFtrVCp+pytD/UG2F/YgJk=\");\n_c = Underwater;\nexport default Underwater;\nvar _c;\n$RefreshReg$(_c, \"Underwater\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","Row","Col","Card","Select","Button","Spin","message","Line","Pie","moment","Chart","DownloadOutlined","jsxDEV","_jsxDEV","Option","transformChartData","backendData","chartType","labels","x","datasets","map","dataset","data","values","backgroundColor","borderColor","borderWidth","Underwater","_s","minDate","maxDate","selectedDate","setSelectedDate","lineChartData","setLineChartData","pieChartData","setPieChartData","error","setError","isLoading","setIsLoading","selectedMetric","setSelectedMetric","availableMetrics","setAvailableMetrics","chartLoaded","setChartLoaded","line","pie","lineChartRef","pieChartRef","generateFilePath","dateString","date","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","downloadChartAsImage","chartRef","chartName","console","log","current","warning","setTimeout","chartInstance","canvas","getChart","content","key","duration","imgData","toBase64Image","link","document","createElement","download","href","click","success","handleSubmit","e","preventDefault","filePath","response","fetch","method","headers","body","JSON","stringify","file_path","target_column","ok","Error","text","json","line_chart_data","pie_chart_data","available_metrics","err","formatDate","format","destroy","update","prev","style","padding","children","textAlign","color","marginBottom","fontSize","fontWeight","textShadow","fileName","_jsxFileName","lineNumber","columnNumber","spinning","tip","onSubmit","gutter","justify","xs","sm","md","type","value","onChange","target","min","max","width","border","borderRadius","boxShadow","placeholder","display","marginTop","height","metric","index","size","onClick","loading","transition","hoverStyle","title","justifyContent","alignItems","icon","disabled","bordered","ref","options","responsive","maintainAspectRatio","interaction","intersect","mode","plugins","legend","position","tooltip","callbacks","label","context","parsed","y","scales","onRender","chart","layout","top","bottom","left","right","font","_c","$RefreshReg$"],"sources":["D:/软件工程/智慧海洋牧场可视化系统/frontend/src/pages/Underwater.js"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { Row, Col, Card, Select, Button, Spin, message } from 'antd';\r\nimport { Line, Pie } from 'react-chartjs-2';\r\nimport moment from 'moment';\r\nimport Chart from 'chart.js/auto'; // 自动注册所有组件\r\nimport { DownloadOutlined } from '@ant-design/icons';\r\n\r\nconst { Option } = Select;\r\n\r\nconst transformChartData = (backendData, chartType) => {\r\n  if (!backendData) return null;\r\n\r\n  if (chartType === 'line') {\r\n    return {\r\n      labels: backendData.x || [],\r\n      datasets: (backendData.datasets || []).map(dataset => ({\r\n        ...dataset,\r\n        data: dataset.data || []\r\n      }))\r\n    };\r\n  }\r\n\r\n  if (chartType === 'pie') {\r\n    return {\r\n      labels: backendData.labels || [],\r\n      datasets: [{\r\n        data: backendData.values || [],\r\n        backgroundColor: backendData.backgroundColor || [\r\n          'rgba(54, 162, 235, 0.7)',\r\n          'rgba(255, 99, 132, 0.7)',\r\n          'rgba(255, 206, 86, 0.7)',\r\n          'rgba(75, 192, 192, 0.7)',\r\n          'rgba(153, 102, 255, 0.7)',\r\n          'rgba(255, 159, 64, 0.7)'\r\n        ],\r\n        borderColor: backendData.borderColor || [\r\n          'rgb(54, 162, 235)',\r\n          'rgb(255, 99, 132)',\r\n          'rgb(255, 206, 86)',\r\n          'rgb(75, 192, 192)',\r\n          'rgb(153, 102, 255)',\r\n          'rgb(255, 159, 64)'\r\n        ],\r\n        borderWidth: backendData.borderWidth || 1\r\n      }]\r\n    };\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nfunction Underwater() {\r\n  // 定义日期范围常量\r\n  const minDate = '2020-05-08';\r\n  const maxDate = '2021-04-05';\r\n\r\n  const [selectedDate, setSelectedDate] = useState(minDate); // 使用minDate初始化\r\n  const [lineChartData, setLineChartData] = useState(null);\r\n  const [pieChartData, setPieChartData] = useState(null);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedMetric, setSelectedMetric] = useState('');\r\n  const [availableMetrics, setAvailableMetrics] = useState([\r\n    '断面名称', '水温(℃)', 'pH(无量纲)', '溶解氧(mg/L)',\r\n    '电导率(μS/cm)', '浊度(NTU)', '高锰酸盐指数(mg/L)',\r\n    '氨氮(mg/L)', '总磷(mg/L)', '总氮(mg/L)', '叶绿素α(mg/L)', '藻密度(cells/L)'\r\n  ]);\r\n  const [chartLoaded, setChartLoaded] = useState({\r\n    line: false,\r\n    pie: false\r\n  });\r\n\r\n  // 用于存储Chart实例的引用\r\n  const lineChartRef = useRef(null);\r\n  const pieChartRef = useRef(null);\r\n\r\n  const generateFilePath = (dateString) => {\r\n    const date = new Date(dateString);\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    return `config/软件工程大作业数据/水质数据/${year}-${month}/${year}-${month}-${day}.json`;\r\n  };\r\n\r\n  // 下载图表为图片\r\n  const downloadChartAsImage = useCallback((chartRef, chartName, chartType) => {\r\n    console.log(`下载${chartType}图表:`, chartName);\r\n    \r\n    if (!chartRef.current) {\r\n      message.warning('图表尚未加载完成');\r\n      return;\r\n    }\r\n    \r\n    // 使用 setTimeout 确保图表完全渲染\r\n    setTimeout(() => {\r\n      try {\r\n        let chartInstance;\r\n        \r\n        // 方式 1: 直接访问 chartInstance 属性\r\n        if (chartRef.current.chartInstance) {\r\n          chartInstance = chartRef.current.chartInstance;\r\n        } \r\n        // 方式 2: 通过 canvas 元素获取\r\n        else if (chartRef.current.canvas) {\r\n          const canvas = chartRef.current.canvas;\r\n          chartInstance = Chart.getChart(canvas);\r\n        }\r\n        \r\n        if (!chartInstance) {\r\n          console.error(`无法获取${chartType}图表实例`);\r\n          message.warning({\r\n            content: '图表加载中，请稍后再试',\r\n            key: `chart-${chartType}-not-ready`,\r\n            duration: 2\r\n          });\r\n          return;\r\n        }\r\n        \r\n        // 生成图片并下载\r\n        const imgData = chartInstance.toBase64Image('image/png', 1.0);\r\n        const link = document.createElement('a');\r\n        link.download = `${chartName}.png`;\r\n        link.href = imgData;\r\n        link.click();\r\n        \r\n        message.success({\r\n          content: `${chartName} 下载成功`,\r\n          key: `download-success-${chartType}`,\r\n          duration: 2\r\n        });\r\n      } catch (error) {\r\n        console.error(`下载${chartType}图表失败:`, error);\r\n        message.error({\r\n          content: '下载图表失败，请重试',\r\n          key: `download-error-${chartType}`,\r\n          duration: 3\r\n        });\r\n      }\r\n    }, 300); // 延迟 300ms 确保图表渲染完成\r\n  }, []);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n    setChartLoaded({ line: false, pie: false }); // 重置图表加载状态\r\n\r\n    try {\r\n      const filePath = generateFilePath(selectedDate);\r\n\r\n      const response = await fetch('http://localhost:3001/visualize-water', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ file_path: filePath, target_column: selectedMetric })\r\n      });\r\n\r\n      if (!response.ok) throw new Error(await response.text());\r\n\r\n      const data = await response.json();\r\n      console.log('后端数据:', data);\r\n\r\n      if (data.error) throw new Error(data.error);\r\n\r\n      // 转换数据格式\r\n      setLineChartData(transformChartData(data.line_chart_data, 'line'));\r\n      setPieChartData(transformChartData(data.pie_chart_data, 'pie'));\r\n      setAvailableMetrics(data.available_metrics || availableMetrics);\r\n\r\n    } catch (err) {\r\n      setError(err.message);\r\n      message.error(err.message);\r\n      setLineChartData(null);\r\n      setPieChartData(null);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString) => {\r\n    return moment(dateString).format('YYYY年MM月DD日');\r\n  };\r\n\r\n  // 组件卸载时销毁Chart实例\r\n  useEffect(() => {\r\n    return () => {\r\n      if (lineChartRef.current) {\r\n        lineChartRef.current.destroy();\r\n      }\r\n      if (pieChartRef.current) {\r\n        pieChartRef.current.destroy();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // 数据更新时更新Chart实例\r\n  useEffect(() => {\r\n    if (lineChartData && lineChartRef.current) {\r\n      if (lineChartRef.current.chartInstance) {\r\n        lineChartRef.current.chartInstance.data = lineChartData;\r\n        lineChartRef.current.chartInstance.update();\r\n        setChartLoaded(prev => ({ ...prev, line: true }));\r\n      }\r\n    }\r\n\r\n    if (pieChartData && pieChartRef.current) {\r\n      if (pieChartRef.current.chartInstance) {\r\n        pieChartRef.current.chartInstance.data = pieChartData;\r\n        pieChartRef.current.chartInstance.update();\r\n        setChartLoaded(prev => ({ ...prev, pie: true }));\r\n      }\r\n    }\r\n  }, [lineChartData, pieChartData]);\r\n\r\n  return (\r\n    <div style={{ padding: '30px', backgroundColor: '#f0f2f5' }}>\r\n      {/* 优化后的标题样式 */}\r\n      <h1 style={{\r\n        textAlign: 'center',\r\n        color: '#1890ff',\r\n        marginBottom: '40px',\r\n        fontSize: '2.5rem',\r\n        fontWeight: '600',\r\n        textShadow: '0 2px 4px rgba(0,0,0,0.1)'\r\n      }}>\r\n        水下环境监测可视化系统\r\n      </h1>\r\n\r\n      <Spin spinning={isLoading} tip=\"正在分析水质数据...\">\r\n        <form onSubmit={handleSubmit} style={{ marginBottom: '40px' }}>\r\n          <Row gutter={24} justify=\"center\">\r\n            <Col xs={24} sm={12} md={8}>\r\n              <input\r\n                type=\"date\"\r\n                value={selectedDate}\r\n                onChange={(e) => setSelectedDate(e.target.value)}\r\n                min={minDate}\r\n                max={maxDate}\r\n                style={{\r\n                  width: '100%',\r\n                  padding: '12px 16px',\r\n                  border: '1px solid #d9d9d9',\r\n                  borderRadius: '8px',\r\n                  fontSize: '16px',\r\n                  boxShadow: '0 1px 3px rgba(0,0,0,0.05)'\r\n                }}\r\n                placeholder=\"选择日期\"\r\n              />\r\n              <span style={{\r\n                display: 'block',\r\n                marginTop: '12px',\r\n                color: '#666',\r\n                fontSize: '14px'\r\n              }}>\r\n                选择日期: {formatDate(selectedDate)}\r\n              </span>\r\n            </Col>\r\n            <Col xs={24} sm={12} md={8}>\r\n              <Select\r\n                value={selectedMetric}\r\n                onChange={(value) => setSelectedMetric(value)}\r\n                style={{\r\n                  width: '100%',\r\n                  height: '52px',\r\n                  fontSize: '16px'\r\n                }}\r\n                placeholder=\"选择监测指标\"\r\n              >\r\n                <Option value=\"\">显示全部指标</Option>\r\n                {availableMetrics.map((metric, index) => (\r\n                  <Option key={index} value={metric}>{metric}</Option>\r\n                ))}\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={24} md={8} style={{ textAlign: 'center', marginTop: '32px' }}>\r\n              {/* 优化后的按钮样式 */}\r\n              <Button\r\n                type=\"primary\"\r\n                size=\"large\"\r\n                onClick={handleSubmit}\r\n                loading={isLoading}\r\n                style={{\r\n                  width: '200px',\r\n                  height: '56px',\r\n                  fontSize: '18px',\r\n                  fontWeight: '500',\r\n                  backgroundColor: '#1890ff',\r\n                  borderColor: '#1890ff',\r\n                  boxShadow: '0 4px 12px rgba(24, 144, 255, 0.3)',\r\n                  borderRadius: '8px',\r\n                  transition: 'all 0.3s ease'\r\n                }}\r\n                hoverStyle={{\r\n                  backgroundColor: '#0d75aa',\r\n                  borderColor: '#0d75aa',\r\n                  boxShadow: '0 6px 16px rgba(24, 144, 255, 0.4)'\r\n                }}\r\n              >\r\n                {isLoading ? '数据生成中...' : '开始可视化分析'}\r\n              </Button>\r\n            </Col>\r\n          </Row>\r\n        </form>\r\n\r\n        {error && (\r\n          <Card\r\n            style={{ marginBottom: '20px', borderColor: '#f5222d' }}\r\n            title={<span style={{ color: '#f5222d' }}>⚠️ 错误提示</span>}\r\n          >\r\n            <p style={{ color: '#f5222d' }}>{error}</p>\r\n          </Card>\r\n        )}\r\n\r\n        <Row gutter={16}>\r\n          {lineChartData && (\r\n            <Col xs={24} md={12}>\r\n              <Card \r\n                title={\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <span>水质参数趋势分析</span>\r\n                    <Button \r\n                      icon={<DownloadOutlined />} \r\n                      size=\"small\"\r\n                      onClick={() => downloadChartAsImage(lineChartRef, '水质参数趋势分析图', 'line')}\r\n                      disabled={!chartLoaded.line}\r\n                    >\r\n                      下载\r\n                    </Button>\r\n                  </div>\r\n                }\r\n                bordered={true}\r\n              >\r\n                <div style={{ height: '400px' }}>\r\n                  <Line\r\n                    ref={lineChartRef}\r\n                    data={lineChartData}\r\n                    options={{\r\n                      responsive: true,\r\n                      maintainAspectRatio: false,\r\n                      interaction: {\r\n                        intersect: false,\r\n                        mode: 'index',\r\n                      },\r\n                      plugins: {\r\n                        legend: {\r\n                          position: 'top',\r\n                        },\r\n                        tooltip: {\r\n                          callbacks: {\r\n                            label: (context) => {\r\n                              return `${context.dataset.label}: ${context.parsed.y}`;\r\n                            }\r\n                          }\r\n                        }\r\n                      },\r\n                      scales: {\r\n                        x: {\r\n                          title: {\r\n                            display: true,\r\n                            text: '时间'\r\n                          }\r\n                        },\r\n                        y: {\r\n                          title: {\r\n                            display: true,\r\n                            text: '数值'\r\n                          }\r\n                        }\r\n                      }\r\n                    }}\r\n                    onRender={(chart) => {\r\n                      console.log('折线图渲染完成');\r\n                      setChartLoaded(prev => ({ ...prev, line: true }));\r\n                    }}\r\n                  />\r\n                </div>\r\n              </Card>\r\n            </Col>\r\n          )}\r\n\r\n          {pieChartData && (\r\n            <Col xs={24} md={12}>\r\n              <Card \r\n                title={\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <span>水质类别分布统计</span>\r\n                    <Button \r\n                      icon={<DownloadOutlined />} \r\n                      size=\"small\"\r\n                      onClick={() => downloadChartAsImage(pieChartRef, '水质类别分布统计图', 'pie')}\r\n                      disabled={!chartLoaded.pie}\r\n                    >\r\n                      下载\r\n                    </Button>\r\n                  </div>\r\n                }\r\n                bordered={true}\r\n              >\r\n                <div style={{ height: '400px', position: 'relative' }}>\r\n                  <Pie\r\n                    ref={pieChartRef}\r\n                    data={pieChartData}\r\n                    options={{\r\n                      responsive: true,\r\n                      maintainAspectRatio: false,\r\n                      layout: {\r\n                        padding: {\r\n                          top: 20,\r\n                          bottom: 20,\r\n                          left: 20,\r\n                          right: 20\r\n                        }\r\n                      },\r\n                      plugins: {\r\n                        legend: {\r\n                          position: 'right',\r\n                          labels: {\r\n                            font: {\r\n                              size: 12\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    }}\r\n                    onRender={(chart) => {\r\n                      console.log('饼图渲染完成');\r\n                      setChartLoaded(prev => ({ ...prev, pie: true }));\r\n                    }}\r\n                  />\r\n                </div>\r\n              </Card>\r\n            </Col>\r\n          )}\r\n        </Row>\r\n      </Spin>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Underwater;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}